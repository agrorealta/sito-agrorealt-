<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabella di Mills - AgroRealtà</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Libreria per il Grafico -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <a href="index.html" class="logo-link">
                <img src="immagini/logo-icona.png" alt="Icona AgroRealtà" class="site-logo">
            </a>
            <h1 class="site-title">AgroRealtà</h1>
            <div class="tagline">L’agricoltura com’è, non come l’immagini</div>
        </div>
    </header>
    
      <nav>
        <ul>
            <!-- Gruppo Principale -->
            <li><a href="index.html">Home</a></li>
            <li><a href="articoli.html">Articoli & Interviste</a></li>
            <li><a href="#chi-siamo">Chi Siamo</a></li>
            <li><a href="#contatti">Contatti</a></li>
            
            <!-- Separatore "A capo" -->
            <li class="break"></li> 

            <!-- Gruppo APP (Stile Accattivante) -->
            <li><a href="mills.html" class="app-link"><i class="fas fa-calculator"></i> App Ticchiolatura</a></li>
            <li><a href="peronospora.html" class="app-link"><i class="fas fa-leaf"></i> App Peronospora</a></li>
            <li><a href="semina.html" class="app-link"><i class="fas fa-seedling"></i> App Semina</a></li>
        </ul>
    </nav>
    
    <main>
        <section class="page-header">
            <h1>Previsione Ticchiolatura (Tabella di Mills)</h1>
            <p>Calcola il rischio di infezione primaria da <em>Venturia inaequalis</em>.</p>
            
            <div class="tool-description">
                <h3>Come funziona questo strumento?</h3>
                <p>
                    La Tabella di Mills mette in relazione la <strong>temperatura media</strong> e le <strong>ore di bagnatura fogliare</strong> per determinare la probabilità di un'infezione fungina. 
                    Inserisci i dati meteo rilevati nel tuo frutteto: il grafico ti mostrerà se ti trovi nella zona verde (sicura) o nelle zone di rischio, aiutandoti a decidere se intervenire.
                </p>
            </div>
        </section>

        <!-- CONTENITORE PRINCIPALE (Flessibile) -->
        <section class="mills-container">
            
            <!-- COLONNA SINISTRA: IL CALCOLATORE -->
            <div class="calculator-box">
                <h3>Inserisci Dati Meteo</h3>
                <form id="millsForm">
                    <div class="input-group">
                        <label for="temperatura"><i class="fas fa-temperature-high"></i> Temperatura Media (°C)</label>
                        <input type="number" id="temperatura" placeholder="Es. 15" min="5" max="30" step="0.1" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="bagnatura"><i class="fas fa-cloud-rain"></i> Ore di Bagnatura (h)</label>
                        <input type="number" id="bagnatura" placeholder="Es. 10" min="0" max="50" step="0.5" required>
                    </div>

                    <button type="button" class="cta-button full-width" onclick="calcolaRischio()">Calcola Rischio</button>
                </form>

                <div id="risultato" class="result-box hidden">
                    <h4>Esito:</h4>
                    <div id="livello-rischio">In attesa dei dati...</div>
                    <p id="consiglio-agronomico"></p>
                </div>
            </div>

            <!-- COLONNA DESTRA: IL GRAFICO -->
            <div class="chart-box">
                <canvas id="millsChart"></canvas>
            </div>

        </section>

        <!-- SEZIONE ARTICOLO APRIBILE -->
        <section class="content-section article-detail expandable-section">
            <!-- Titolo cliccabile -->
            <h2 onclick="toggleArticle()" class="expand-trigger">
                Ticchiolatura del melo <br>
                <span class="expand-hint">(clicca per maggiori informazioni <i class="fas fa-chevron-down"></i>)</span>
            </h2>
            
            <!-- Contenuto Nascosto -->
            <div id="info-ticchiolatura" class="article-content-hidden">
                <div class="article-text-block">
                    <h3>Il Patogeno e il Ciclo Biologico</h3>
                    <p>
                        La ticchiolatura è la principale avversità fungina del melo, causata dal fungo ascomicete <em>Venturia inaequalis</em>. Il patogeno trascorre l'inverno come saprofita nelle foglie cadute a terra. In primavera, in concomitanza con le piogge e l'innalzamento delle temperature, avviene il rilascio delle ascospore (infezione primaria). Se queste riescono a penetrare nei tessuti vegetali, il fungo si insedia e inizia a produrre conidi, responsabili delle infezioni secondarie che possono susseguirsi per tutta la stagione vegetativa.
                    </p>

                    <!-- IMMAGINE 1 -->
                    <div class="article-img-container">
                        <img src="immagini/Ticchiolatura1.jpg" alt="Sintomi di ticchiolatura su foglia e frutto" class="article-img">
                        <p class="caption">Fig. 1 - Sintomi tipici di ticchiolatura su foglia: macchie bruno-olivacee.</p>
                    </div>

                    <h3>Sintomi e Danni</h3>
                    <p>
                        La malattia colpisce tutti gli organi verdi della pianta: foglie, fiori e frutti. Sulle foglie, i sintomi iniziali si manifestano come macchie d'olio che successivamente scuriscono, assumendo un aspetto bruno-olivaceo e vellutato dovuto alla sporulazione del fungo. Sui frutti, l'attacco provoca la formazione di macchie nerastre e suberose ("ticchiolature") che arrestano l'accrescimento dei tessuti, causando deformazioni e spaccature profonde che rendono il prodotto non commerciabile.
                    </p>

                    <h3>Strategie di Difesa e Modelli Previsionali</h3>
                    <p>
                        La difesa contro la ticchiolatura è prevalentemente preventiva. Una volta che il fungo è penetrato sotto la cuticola, è difficile da eradicare. Per questo motivo, strumenti come la <strong>Tabella di Mills</strong> sono fondamentali: permettono di individuare con precisione i momenti in cui si verificano le condizioni termo-igrometriche idonee all'infezione.
                    </p>
                    
                    <!-- IMMAGINE 2 -->
                    <div class="article-img-container">
                        <img src="immagini/Ticchiolatura2.png" alt="Danni gravi da ticchiolatura su mela" class="article-img">
                        <p class="caption">Fig. 2 - Danni avanzati sul frutto che ne compromettono la commercializzazione.</p>
                    </div>
                    
                    <br><br>

                    <p>
                        Oggi, la tabella classica di Mills è alla base dei moderni <strong>Sistemi di Supporto alle Decisioni (DSS)</strong>. Questi modelli digitali integrano dati meteo in tempo reale, previsioni e stadi fenologici della pianta per consigliare all'agricoltore il momento esatto per intervenire, ottimizzando l'uso dei fitofarmaci (copertura o curativi retroattivi) e riducendo l'impatto ambientale.
                    </p>
                </div>
            </div>
        </section>
    </main>
    
    <footer>
        <div class="footer-content">
            <p>AgroRealtà - Un progetto di divulgazione sull'agricoltura moderna.</p>
            <div class="footer-links">
                <a href="index.html#chi-siamo">Chi Siamo</a>
                <a href="mailto:agrorealta@gmail.com">Contattaci via Email</a>
            </div>
            <div class="copyright">© 2025 AgroRealtà - Tutti i diritti riservati</div>
        </div>
    </footer>

    <!-- LOGICA JAVASCRIPT -->
    <script>
        // --- FUNZIONE PER APRIRE/CHIUDERE L'ARTICOLO ---
        function toggleArticle() {
            const content = document.getElementById('info-ticchiolatura');
            const hint = document.querySelector('.expand-hint');
            
            if (content.style.display === "block") {
                content.style.display = "none";
                hint.innerHTML = '(clicca per maggiori informazioni <i class="fas fa-chevron-down"></i>)';
            } else {
                content.style.display = "block";
                hint.innerHTML = '(clicca per chiudere <i class="fas fa-chevron-up"></i>)';
            }
        }

        // --- DATI MILLS ---
        const labelsTemp = [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25];
        const lightInf = [21, 19, 17, 15, 14, 13, 12, 11, 10, 9.5, 9, 9, 9, 9, 9, 9, 9.5, 10, 10.5, 11];
        const moderateInf = [28, 26, 23, 20, 19, 17, 16, 15, 14, 13, 12, 12, 12, 12, 12, 12, 13, 14, 14.5, 15];
        const severeInf = [41, 37, 33, 29, 26, 23, 21, 19, 18, 17, 16, 15, 15, 15, 15, 15, 16, 17, 18, 19];

        let chartInstance = null;

        function initChart() {
            const ctx = document.getElementById('millsChart').getContext('2d');
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labelsTemp,
                    datasets: [
                        {
                            label: 'Rischio GRAVE',
                            data: severeInf,
                            borderColor: '#DC143C',
                            backgroundColor: 'rgba(220, 20, 60, 0.2)', 
                            fill: 'end', 
                            tension: 0.4
                        },
                        {
                            label: 'Rischio MEDIO',
                            data: moderateInf,
                            borderColor: '#FF8C00',
                            backgroundColor: 'rgba(255, 140, 0, 0.2)', 
                            fill: 0, 
                            tension: 0.4
                        },
                        {
                            label: 'Rischio LIEVE',
                            data: lightInf,
                            borderColor: '#FFD700',
                            backgroundColor: 'rgba(255, 215, 0, 0.2)', 
                            fill: 1, 
                            tension: 0.4
                        },
                        {
                            label: 'Zona Sicura',
                            data: Array(labelsTemp.length).fill(0), 
                            borderColor: 'transparent',
                            backgroundColor: 'rgba(44, 95, 52, 0.1)', 
                            fill: 2, 
                            pointRadius: 0
                        },
                        {
                            label: 'TU SEI QUI', 
                            data: [], 
                            pointBackgroundColor: 'blue',
                            pointBorderColor: '#fff',
                            pointRadius: 10,
                            pointHoverRadius: 12,
                            showLine: false,
                            type: 'scatter'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, /* IMPORTANTE PER L'ALTEZZA */
                    plugins: {
                        title: { display: true, text: 'Curve di Infezione (Tabella di Mills)', font: { size: 16 } },
                        tooltip: { mode: 'index', intersect: false },
                        legend: {
                            labels: { filter: function(item) { return !item.text.includes('Zona Sicura'); } }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Temperatura (°C)' } },
                        y: { title: { display: true, text: 'Ore di Bagnatura (h)' }, min: 0, max: 50 }
                    }
                }
            });
        }

        function calcolaRischio() {
            const temp = parseFloat(document.getElementById('temperatura').value);
            const ore = parseFloat(document.getElementById('bagnatura').value);
            const resultBox = document.getElementById('risultato');
            const livelloDiv = document.getElementById('livello-rischio');
            const consiglioDiv = document.getElementById('consiglio-agronomico');

            if (isNaN(temp) || isNaN(ore)) {
                alert("Inserisci valori validi!");
                return;
            }

            let closestTempIndex = -1;
            let minDiff = 100;
            for(let i=0; i<labelsTemp.length; i++) {
                if(Math.abs(labelsTemp[i] - temp) < minDiff) {
                    minDiff = Math.abs(labelsTemp[i] - temp);
                    closestTempIndex = i;
                }
            }

            let rischio = "NESSUN RISCHIO";
            let colore = "#2c5f34"; 
            let consiglio = "Condizioni non favorevoli all'infezione.";

            if (closestTempIndex !== -1) {
                const l = lightInf[closestTempIndex];
                const m = moderateInf[closestTempIndex];
                const s = severeInf[closestTempIndex];

                if (ore >= s) {
                    rischio = "RISCHIO GRAVE";
                    colore = "#DC143C"; 
                    consiglio = "Probabile infezione massiccia. Intervento curativo immediato.";
                } else if (ore >= m) {
                    rischio = "RISCHIO MEDIO";
                    colore = "#FF8C00"; 
                    consiglio = "Condizioni favorevoli all'infezione. Valutare intervento.";
                } else if (ore >= l) {
                    rischio = "RISCHIO LIEVE";
                    colore = "#d4b106"; 
                    consiglio = "Possibile infezione leggera. Monitorare.";
                }
            }

            resultBox.classList.remove('hidden');
            livelloDiv.innerHTML = rischio;
            livelloDiv.style.color = colore;
            livelloDiv.style.fontWeight = "bold";
            livelloDiv.style.fontSize = "1.5rem";
            consiglioDiv.innerHTML = consiglio;

            chartInstance.data.datasets[4].data = [{x: temp, y: ore}];
            chartInstance.update();
        }

        window.onload = initChart;
    </script>
</body>
</html>